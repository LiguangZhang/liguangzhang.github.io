<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"liguangzhang.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="blog">
<meta property="og:url" content="https://liguangzhang.github.io/page/7/index.html">
<meta property="og:site_name" content="blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="liguang.zhang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://liguangzhang.github.io/page/7/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://liguangzhang.github.io/2022/03/25/TEE/%E4%B8%89%E7%BA%A7%E8%AF%81%E4%B9%A6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liguang.zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/25/TEE/%E4%B8%89%E7%BA%A7%E8%AF%81%E4%B9%A6/" class="post-title-link" itemprop="url">三级证书</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-03-25 18:15:54" itemprop="dateCreated datePublished" datetime="2022-03-25T18:15:54+08:00">2022-03-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-04-16 17:29:17" itemprop="dateModified" datetime="2024-04-16T17:29:17+08:00">2024-04-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">安全</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="证书和签名制作过程"><a href="#证书和签名制作过程" class="headerlink" title="证书和签名制作过程"></a>证书和签名制作过程</h2><p>真正的签名image hash的key是最底层的⼀把key，这个key在每次签名的时候都会随机⽣成，即使是同⼀个机型不同⽇期编出来的包，这把key都不会⼀样，取⽽代之的是，这对keypair的公钥会在服务器上被attestation key签发⼀个证书，⽽attestation privatekey⼜是被rootkey签发的，形成⼀套证书链校验，这样的好处是OEM和⾼通可以灵活的控制签名的流程，⽐如ODM就不能和OEM拥有同⼀个key，但是每个机型都重新⽣成fuse⼜显得⼗分冗余和难以维护，这样的解决⽅案会显得更加灵活可以在不变更fuse的情况下，允许secureboot有多位参与者 <a href="bookxnotepro://opennote/?nb={f0d472c4-48cb-46a1-b142-de6e7beec9f3}&book=209b00fe1ba72a6a1472e7231a9fce0c&page=0&x=364&y=594&id=1">001</a></p>
<p>服务器会调⽤openssl进⾏签名,具体的流程是,服务器上已经有了固定的rootkey和attestation key以及相应的证书,签名过程中会随机⽣成⼀把attesst key,并且使⽤attestationkey进⾏签名颁发证书,最后使⽤这把随机⽣成的attestkey对⽂件的hash进⾏签名,最后把签名以及三份证书已经签名传回客户端 <a href="bookxnotepro://opennote/?nb={9d8886df-b728-405b-abe2-f5995a755697}&book=77ec177cb4de2c84885767ccb705f23c&page=0&x=367&y=898&id=1">001</a></p>
<p>三份证书和签名返回客户端并按照既定格式组装到未签名的⽂件中,形成签名⽂件.最后覆盖源⽂件 <a href="bookxnotepro://opennote/?nb={9d8886df-b728-405b-abe2-f5995a755697}&book=77ec177cb4de2c84885767ccb705f23c&page=0&x=343&y=908&id=2">001</a></p>
<h2 id="签名流程图"><a href="#签名流程图" class="headerlink" title="签名流程图"></a>签名流程图</h2><p><img src="https://cdn.jsdelivr.net/gh/LiguangZhang/tuchuang1@main/images/20220420121123.svg"></p>

          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2022/03/25/TEE/%E4%B8%89%E7%BA%A7%E8%AF%81%E4%B9%A6/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://liguangzhang.github.io/2022/03/25/TEE/arm%E7%A1%AC%E4%BB%B6%E5%AE%89%E5%85%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liguang.zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/25/TEE/arm%E7%A1%AC%E4%BB%B6%E5%AE%89%E5%85%A8/" class="post-title-link" itemprop="url">arm trustzone</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-03-25 18:15:54" itemprop="dateCreated datePublished" datetime="2022-03-25T18:15:54+08:00">2022-03-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-04-16 15:47:21" itemprop="dateModified" datetime="2024-04-16T15:47:21+08:00">2024-04-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">安全</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Software-virtualization"><a href="#Software-virtualization" class="headerlink" title="Software virtualization"></a>Software virtualization</h2><p>​		虚拟化是一种软件安全机制，其中一个高度可信的管理层，称为虚拟机管理程序，以通用处理器的特权模式运行。 管理程序将在其顶部的多个独立软件平台分开使用内存管理单元（MMU），将每个内存置于由管理程序软件控制的虚拟机内部。</p>
<h3 id="弊端"><a href="#弊端" class="headerlink" title="弊端"></a>弊端</h3><p>​		虚拟化技术提供的隔离仅限于实现管理程序的处理器。系统中的任何其他总线上主控，如DMA引擎和GPU，都可以绕过hypervisor提供的保护，因此也必须由hypervisor管理，以执行所需的安全策略。这很难在不损害系统性能的情况下实现; 在不降低图形性能的情况下验证可编程GPU的复杂输入超出了大多数虚拟化解决方案的范围。</p>
<p>​		虚拟化忽略与硬件攻击相关的安全问题，例如使用调试或测试基础设施的威胁。为了保护虚拟系统免受这种攻击，需要完全禁用调试和测试可见性，这使得软件开发和缺陷诊断非常困难。</p>
<h2 id="TrustZone技术对资源隔离的实现"><a href="#TrustZone技术对资源隔离的实现" class="headerlink" title="TrustZone技术对资源隔离的实现"></a>TrustZone技术对资源隔离的实现</h2><p>​		ARM处理器核的虚拟化和资源隔离是TrustZone实现安全需求的根本。支持TrustZone的处理器核具有虚拟化，也即将一个物理核分成安全状态和非安全状态。当处理器处于非安全状态时，只能访问属于非安全的外设和内存，而不能访问安全的资源；当处理器处于安全态时，处理器既可以访问安全资源，也可以访问非安全的资源，只有当处理器核为安全世界状态时才可能发出PROT的安全访问信号。</p>
<h3 id="中断源的隔离"><a href="#中断源的隔离" class="headerlink" title="中断源的隔离"></a>中断源的隔离</h3><p>​		在原来的ARM芯片中，使用VIC来对外部中断源进行控制和管理，支持TrustZone后，ARM提出了<code>TZIC</code>组件，在芯片设计时，该组件作为一级中断源控制器，控制所有的外部中断源，通过编程TZIC组件的相关寄存器来设定哪个中断源为安全中断源<code>FIQ</code>，而未被设定的中断源将会被传递给VIC进行处理。一般情况下VIC会将接收到的中断源设定成普通中断请求（Interrupt Request，IRQ），如果在VIC中将接收到的中断源设定成FIQ，则该中断源会被反馈给TZIC组件，TZIC组件会将安全中断源送到安全世界状态中进行处理。</p>
<h3 id="片上RAM和片上ROM的隔离"><a href="#片上RAM和片上ROM的隔离" class="headerlink" title="片上RAM和片上ROM的隔离"></a>片上RAM和片上ROM的隔离</h3>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2022/03/25/TEE/arm%E7%A1%AC%E4%BB%B6%E5%AE%89%E5%85%A8/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://liguangzhang.github.io/2022/03/25/hxd_new/kernel%E4%B8%AD%E6%96%AD%E7%9B%B8%E5%85%B3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liguang.zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/25/hxd_new/kernel%E4%B8%AD%E6%96%AD%E7%9B%B8%E5%85%B3/" class="post-title-link" itemprop="url">linux 中断相关</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-03-25 18:15:54" itemprop="dateCreated datePublished" datetime="2022-03-25T18:15:54+08:00">2022-03-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-04-16 16:35:46" itemprop="dateModified" datetime="2024-04-16T16:35:46+08:00">2024-04-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%B8%AD%E6%96%AD/" itemprop="url" rel="index"><span itemprop="name">中断</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%B8%AD%E6%96%AD/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>本文由 <a target="_blank" rel="noopener" href="http://ksria.com/simpread/">简悦 SimpRead</a> 转码， 原文地址 <a target="_blank" rel="noopener" href="http://kernel.meizu.com/linux-interrupt.html">kernel.meizu.com</a></p>
</blockquote>
<blockquote>
<p>在面试的时候我们常常被问及一个问题：几种中断下半部机制 softirq、tasklet、workqueue 有什么区别？Linux 为什么要设计这几种机制？真正能够回答清楚的人还是少数的。</p>
</blockquote>
<p>在面试的时候我们常常被问及一个问题：几种中断下半部机制 softirq、tasklet、workqueue 有什么区别？Linux 为什么要设计这几种机制？真正能够回答清楚的人还是少数的。下面我们就详细分析一下这其中的区别。</p>
<blockquote>
<p>本文的代码分析基于 Linux kernel 3.18.22 和 arm64 架构，最好的学习方法还是 “RTFSC”</p>
</blockquote>
<ol>
<li>Linux 中断</li>
</ol>
<hr>
<p>arm64 和其他所有 CPU 架构的中断处理流程都是一样：正常执行流程被打断进入中断服务程序，保护现场、处理中断、恢复现场：</p>
<p><img src="http://kernel.meizu.com/images/posts/2016/09/int_handler.png">     中断处理 <a href="#fn:ARMPG">1</a></p>
<p>在整个中断处理过程中，arm64 的 CPU 全局中断是自动 disable 的 (PSTATE 寄存器中的 interrupt bit 被 masks)。如果用户想支持 interrupt nested，需要自己在中断服务程序中使能中断。Linux 现在是不使用中断嵌套的。</p>
<p><img src="http://kernel.meizu.com/images/posts/2016/09/int_nested_handler.png"> “ 中断嵌套处理 “ 中断嵌套处理 <a href="#fn:ARMPG">1</a></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2022/03/25/hxd_new/kernel%E4%B8%AD%E6%96%AD%E7%9B%B8%E5%85%B3/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://liguangzhang.github.io/2022/02/12/TEE/%E5%A4%9Aroot%20key%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liguang.zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/02/12/TEE/%E5%A4%9Aroot%20key%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">多root key 管理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-02-12 18:15:54" itemprop="dateCreated datePublished" datetime="2022-02-12T18:15:54+08:00">2022-02-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-04-16 15:45:28" itemprop="dateModified" datetime="2024-04-16T15:45:28+08:00">2024-04-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">安全</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>多个信任根：允许具有不同访问权限的多个实体共享芯片，同时每个实体都有自己的 “虚拟 “安全核心和私有安全域。</p>
<p>分层安全：加强对加密模块和其他安全资源的访问。确保关键密钥只能通过硬件获得，不能通过软件访问。</p>
<p>隔离操作：在远离通用处理的专用安全执行域中执行广泛的安全功能</p>
<p>目的性强：从根本上为安全而设计。具有最先进的防篡改和安全技术，包括抵抗侧信道和故障注入攻击。</p>
<h3 id="Sharing-a-Root-of-Trust-is-Potentially-Risky"><a href="#Sharing-a-Root-of-Trust-is-Potentially-Risky" class="headerlink" title="Sharing a Root of Trust is Potentially Risky"></a>Sharing a Root of Trust is Potentially Risky</h3><p>一旦进入安全域，一个应用程序被认为是安全的。但如果一个应用程序实际上是恶意的呢？- 该应用程序可能会感染其他人，窃取信息，并将敏感信息暴露给恶意的一方<br>在一个单一的信任根内，一方的恶意程序可以访问另一方的敏感信息</p>
<h2 id="multi-roots-of-trust"><a href="#multi-roots-of-trust" class="headerlink" title="multi roots of trust"></a>multi roots of trust</h2><p>Multiple Roots of Trust <a href="bookxnotepro://opennote/?nb={af27f419-aaf4-494d-b2a4-9f05f129b37d}&book=3f4f03b2bf8e973c33f1d9a004beb8bb&page=40&x=200&y=48&id=4">041</a></p>
<p>相比之下，多个root key可允许不同的实体，如芯片供应商、OEM和服务提供商在同一芯片中拥有自己的 “虚拟 “安全核心，但每个都有一个私有安全域。<br>每个实体都拥有其签名的应用程序集。当处理器切换应用程序时，所有的上下文都会从处理器中刷新。默认情况下，没有数据、密钥或其他信息持续存在，确保实体之间不共享上下文<br>密钥被分配给每个根，允许应用程序在每个根中以不同的方式进行签名。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LiguangZhang/tuchuang1@main/images/20220511145341.png"></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2022/02/12/TEE/%E5%A4%9Aroot%20key%E7%AE%A1%E7%90%86/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://liguangzhang.github.io/2022/01/12/TEE/%E5%AE%89%E5%85%A8%E7%AE%97%E6%B3%95%E4%BB%8B%E7%BB%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liguang.zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/12/TEE/%E5%AE%89%E5%85%A8%E7%AE%97%E6%B3%95%E4%BB%8B%E7%BB%8D/" class="post-title-link" itemprop="url">安全算法介绍</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-12 18:15:54" itemprop="dateCreated datePublished" datetime="2022-01-12T18:15:54+08:00">2022-01-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-04-16 15:45:34" itemprop="dateModified" datetime="2024-04-16T15:45:34+08:00">2024-04-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">安全</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AE%89%E5%85%A8/%E5%8A%A0%E5%AF%86/" itemprop="url" rel="index"><span itemprop="name">加密</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="md5"><a href="#md5" class="headerlink" title="md5"></a>md5</h1><p><strong>MD5消息摘要算法</strong>（英语：MD5 Message-Digest Algorithm），一种被广泛使用的<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%AF%86%E7%A2%BC%E9%9B%9C%E6%B9%8A%E5%87%BD%E6%95%B8" title="密码散列函数">密码散列函数</a>，可以产生出一个128位（16个字符(BYTES)）的散列值（hash value）</p>
<p>1996年后被证实存在弱点，可以被加以<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E7%A0%B4%E8%A7%A3" title="破解">破解</a>，对于需要高度安全性的资料，专家一般建议改用其他算法，如<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/SHA-2" title="SHA-2">SHA-2</a>。2004年，证实MD5算法无法防止<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/w/index.php?title=%E7%A2%B0%E6%92%9E%E6%94%BB%E5%87%BB&action=edit&redlink=1">碰撞攻击</a>，因此不适用于安全性认证，如<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/SSL" title="SSL">SSL</a><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%85%AC%E9%96%8B%E9%87%91%E9%91%B0%E8%AA%8D%E8%AD%89" title="公开密钥认证">公开密钥认证</a>或是<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%95%B8%E4%BD%8D%E7%B0%BD%E7%AB%A0" title="数字签名">数字签名</a>等用途。</p>
<h2 id="缺陷"><a href="#缺陷" class="headerlink" title="缺陷"></a>缺陷</h2><p>2009年，<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E4%B8%AD%E5%9C%8B%E7%A7%91%E5%AD%B8%E9%99%A2" title="中国科学院">中国科学院</a>的谢涛和冯登国仅用了220.96的碰撞算法复杂度，破解了MD5的碰撞抵抗，该攻击在普通计算机上运行只需要数秒钟<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/MD5#cite_note-3">[3]</a>。2011年，<a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc6151">RFC 6151</a> 禁止MD5用作<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E9%87%91%E9%91%B0%E9%9B%9C%E6%B9%8A%E8%A8%8A%E6%81%AF%E9%91%91%E5%88%A5%E7%A2%BC" title="密钥散列消息认证码">密钥散列消息认证码</a>。</p>
<h1 id="sha"><a href="#sha" class="headerlink" title="sha"></a>sha</h1><ul>
<li><p>**<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/SHA-0" title="SHA-0">SHA-0</a>**：1993年发布，当时称做安全散列标准（Secure Hash Standard），发布之后很快就被NSA撤回，是SHA-1的前身。</p>
</li>
<li><p>**<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/SHA-1" title="SHA-1">SHA-1</a>**：1995年发布，SHA-1在许多安全协议中广为使用，包括<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/TLS" title="TLS">TLS</a>、<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/GnuPG" title="GnuPG">GnuPG</a>、<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/Secure_Shell" title="Secure Shell">SSH</a>、<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/S/MIME" title="S/MIME">S&#x2F;MIME</a>和<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/IPsec" title="IPsec">IPsec</a>，是<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/MD5" title="MD5">MD5</a>的后继者。但SHA-1的安全性在2010年以后已经不被大多数的加密场景所接受。2017年荷兰密码学研究小组CWI和Google正式宣布攻破了SHA-1<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/SHA%E5%AE%B6%E6%97%8F#cite_note-1">[1]</a>。</p>
</li>
<li><p>**<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/SHA-2" title="SHA-2">SHA-2</a>**：2001年发布，包括SHA-224、SHA-256、SHA-384、SHA-512、SHA-512&#x2F;224、SHA-512&#x2F;256。SHA-2目前没有出现明显的弱点。虽然至今尚未出现对SHA-2有效的攻击，但它的算法跟SHA-1基本上仍然相似。</p>
</li>
<li><p>**<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/SHA-3" title="SHA-3">SHA-3</a>**：2015年正式发布，由于对MD5出现成功的破解，以及对SHA-0和SHA-1出现理论上破解的方法，<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%9C%8B%E5%AE%B6%E6%A8%99%E6%BA%96%E6%9A%A8%E6%8A%80%E8%A1%93%E7%A0%94%E7%A9%B6%E9%99%A2" title="国家标准暨技术研究院">NIST</a>感觉需要一个与之前算法不同的，可替换的加密散列算法，也就是现在的SHA-3。</p>
</li>
</ul>
<h2 id="sha-家族函数对比"><a href="#sha-家族函数对比" class="headerlink" title="sha 家族函数对比"></a>sha 家族函数对比</h2><table class="wikitable" style="margin-top: 0px; width:100%">
<caption>SHA函数对比
</caption>
<tbody><tr style="vertical-align:bottom;">
<th colspan="2">算法和变体
</th>
<th>输出散列值长度<br>（bits）
</th>
<th>中继散列值长度<br>（bits）
</th>
<th>资料区块长度<br>（bits）
</th>
<th>最大输入消息长度<br>（bits）
</th>
<th>循环次数
</th>
<th>使用到的运算符
</th>
<th>碰撞攻击<br>（bits）
</th>
<th>性能示例<sup id="cite_ref-3" class="reference"><a href="#cite_note-3">[3]</a></sup><br>(<a href="/wiki/Mebibyte" title="Mebibyte">MiB</a>/s)
</th></tr>
<tr style="text-align:center;vertical-align:top;">
<td colspan="2"><b><a href="/wiki/MD5" title="MD5">MD5</a></b>（作为参考）</td>
<td>128</td>
<td>128<br><span class="nowrap">(4 × 32)</span></td>
<td>512</td>
<td>无限<sup id="cite_ref-4" class="reference"><a href="#cite_note-4">[4]</a></sup></td>
<td>64</td>
<td>And, Xor, Rot, <span class="nowrap">Add (mod&nbsp;2<sup>32</sup>),</span> Or</td>
<td class="table-no" style="text-align: center; background: rgb(255, 144, 144); --darkreader-inline-bgimage: initial; --darkreader-inline-bgcolor:#760000;" data-darkreader-inline-bgimage data-darkreader-inline-bgcolor>≤18<br>（发现碰撞）</td>
<td>335
</td></tr>
<tr style="text-align:center;vertical-align:top;">
<td colspan="2"><b><span class="nowrap"><a href="/wiki/SHA-0" class="mw-redirect" title="SHA-0">SHA-0</a></span></b></td>
<td>160</td>
<td>160<br><span class="nowrap">(5 × 32)</span></td>
<td>512</td>
<td>2<sup>64</sup> − 1</td>
<td>80</td>
<td rowspan="2">And, Xor, Rot, <span class="nowrap">Add (mod&nbsp;2<sup>32</sup>),</span> Or</td>
<td class="table-no" style="text-align: center; background: rgb(255, 144, 144); --darkreader-inline-bgimage: initial; --darkreader-inline-bgcolor:#760000;" data-darkreader-inline-bgimage data-darkreader-inline-bgcolor>&lt;34<br>（发现碰撞）</td>
<td>-
</td></tr>
<tr style="text-align:center;vertical-align:top;">
<td colspan="2"><b><span class="nowrap"><a href="/wiki/SHA-1" title="SHA-1">SHA-1</a></span></b></td>
<td>160</td>
<td>160<br><span class="nowrap">(5 × 32)</span></td>
<td>512</td>
<td>2<sup>64</sup> − 1</td>
<td>80</td>
<td class="table-no" style="text-align: center; background: rgb(255, 144, 144); --darkreader-inline-bgimage: initial; --darkreader-inline-bgcolor:#760000;" data-darkreader-inline-bgimage data-darkreader-inline-bgcolor>&lt;63<sup id="cite_ref-5" class="reference"><a href="#cite_note-5">[5]</a></sup><br>（发现碰撞<sup id="cite_ref-6" class="reference"><a href="#cite_note-6">[6]</a></sup>）</td>
<td>192
</td></tr>
<tr style="text-align:center;vertical-align:top;">
<td rowspan="2"><b><span class="nowrap"><a href="/wiki/SHA-2" title="SHA-2">SHA-2</a></span></b></td>
<td><i>SHA-224</i><br><i>SHA-256</i></td>
<td>224<br>256</td>
<td>256<br><span class="nowrap">(8 × 32)</span></td>
<td>512</td>
<td>2<sup>64</sup> − 1</td>
<td>64</td>
<td>And, Xor, Rot, <span class="nowrap">Add (mod&nbsp;2<sup>32</sup>),</span> Or, Shr</td>
<td style="background: rgb(153, 255, 153); color: black; vertical-align: middle; text-align: center; --darkreader-inline-bgimage: initial; --darkreader-inline-bgcolor:#1c7000; --darkreader-inline-color:#e8e6e3;" class="yes table-yes2" data-darkreader-inline-bgimage data-darkreader-inline-bgcolor data-darkreader-inline-color>112 <br> 128</td>
<td>139
</td></tr>
<tr style="text-align:center;vertical-align:top;">
<td><i>SHA-384</i><br><i>SHA-512</i><br><i><span class="nowrap">SHA-512/224</span></i><br><i><span class="nowrap">SHA-512/256</span></i></td>
<td>384<br>512<br>224 <br>256</td>
<td>512<br><span class="nowrap">(8 × 64)</span></td>
<td>1024</td>
<td>2<sup>128</sup> − 1</td>
<td>80</td>
<td>And, Xor, Rot, <span class="nowrap">Add (mod&nbsp;2<sup>64</sup>),</span> Or, Shr</td>
<td style="background: rgb(153, 255, 153); color: black; vertical-align: middle; text-align: center; --darkreader-inline-bgimage: initial; --darkreader-inline-bgcolor:#1c7000; --darkreader-inline-color:#e8e6e3;" class="yes table-yes2" data-darkreader-inline-bgimage data-darkreader-inline-bgcolor data-darkreader-inline-color>192<br>256<br>112<br>128</td>
<td>154
</td></tr>
<tr style="text-align:center;vertical-align:top;">
<td rowspan="2"><b><span class="nowrap"><a href="/wiki/SHA-3" title="SHA-3">SHA-3</a></span></b></td>
<td><i>SHA3-224</i><br><i>SHA3-256</i><br><i>SHA3-384</i><br><i>SHA3-512</i></td>
<td>224<br>256<br>384<br>512</td>
<td rowspan="2">1600<br><span class="nowrap">(5 × 5 × 64)</span></td>
<td>1152<br>1088<br>832<br>576</td>
<td rowspan="2">无限<sup id="cite_ref-7" class="reference"><a href="#cite_note-7">[7]</a></sup></td>
<td rowspan="2">24<sup id="cite_ref-8" class="reference"><a href="#cite_note-8">[8]</a></sup></td>
<td rowspan="2">And, Xor, Rot, Not</td>
<td style="background: rgb(153, 255, 153); color: black; vertical-align: middle; text-align: center; --darkreader-inline-bgimage: initial; --darkreader-inline-bgcolor:#1c7000; --darkreader-inline-color:#e8e6e3;" class="yes table-yes2" data-darkreader-inline-bgimage data-darkreader-inline-bgcolor data-darkreader-inline-color>112<br>128<br>192<br>256</td>
<td>-
</td></tr>
<tr style="text-align:center;vertical-align:top;">
<td><i>SHAKE128</i><br><i>SHAKE256</i></td>
<td><span class="nowrap"><i>d</i> (arbitrary)</span><br><span class="nowrap"><i>d</i> (arbitrary)</span></td>
<td>1344<br>1088</td>
<td style="background: rgb(153, 255, 153); color: black; vertical-align: middle; text-align: center; --darkreader-inline-bgimage: initial; --darkreader-inline-bgcolor:#1c7000; --darkreader-inline-color:#e8e6e3;" class="yes table-yes2" data-darkreader-inline-bgimage data-darkreader-inline-bgcolor data-darkreader-inline-color>min(<i>d</i>/2, 128)<br>min(<i>d</i>/2, 256)</td>
<td>-
</td></tr></tbody></table>

<h1 id="CRC"><a href="#CRC" class="headerlink" title="CRC"></a>CRC</h1>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2022/01/12/TEE/%E5%AE%89%E5%85%A8%E7%AE%97%E6%B3%95%E4%BB%8B%E7%BB%8D/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://liguangzhang.github.io/2021/10/11/hxd_new/%E5%AE%89%E5%85%A8%E9%9C%80%E6%B1%82/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liguang.zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/10/11/hxd_new/%E5%AE%89%E5%85%A8%E9%9C%80%E6%B1%82/" class="post-title-link" itemprop="url">安全需求</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-10-11 18:15:54" itemprop="dateCreated datePublished" datetime="2021-10-11T18:15:54+08:00">2021-10-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-04-16 14:53:41" itemprop="dateModified" datetime="2024-04-16T14:53:41+08:00">2024-04-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">安全</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>ecu 固件恶意修改防护, 固件加密防护防止恶意破解访问或数字签名防护恶意篡改, 固件安全升级防护</p>
<p>ECU上网络服务器的使用应仅限于其必要的功能，服务端口应加以保护以防止未经授权的使用</p>
<p>使用分段和隔离技术：特权分离与边界控制能够提升系统安全性。逻辑和物理隔离技术应用于将处理器、车辆网络和外部连接分开，以限制和控制外部威胁到车辆内部的路径。</p>
<p>边界控制技术，如严格的基于白名单的段间消息过滤机制，应被用于保障接口访问安全</p>
<p>debug调试机制限制, 诊断操作需要尽可能施加较多的限制措施，例如限制某个诊断操作的影响范围或时间</p>
<p>车辆内部通讯控制: <strong>安全关键的消息尽量通过硬件隔离的安全总线传输</strong></p>
<p>证书管理:  后台服务器访问控制：加密措施应用于任何基于IP的外部服务器和车辆之间的业务通信过程中。此类网络连接不应接受无效证书</p>

          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/10/11/hxd_new/%E5%AE%89%E5%85%A8%E9%9C%80%E6%B1%82/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://liguangzhang.github.io/2021/09/12/hxd_new/bl_guide/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liguang.zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/12/hxd_new/bl_guide/" class="post-title-link" itemprop="url">bl 加密手册</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-12 18:15:54" itemprop="dateCreated datePublished" datetime="2021-09-12T18:15:54+08:00">2021-09-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-04-16 14:55:31" itemprop="dateModified" datetime="2024-04-16T14:55:31+08:00">2024-04-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%8D%9A%E6%B5%81/" itemprop="url" rel="index"><span itemprop="name">博流</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="打开或者关闭加密"><a href="#打开或者关闭加密" class="headerlink" title="打开或者关闭加密"></a>打开或者关闭加密</h1><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">examples/usb/usb_mic/CMakeLists.txt</span><br><span class="line"><span class="comment"># 打开加密</span></span><br><span class="line"><span class="keyword">set</span>(BL_ENCRYPTING yes)</span><br><span class="line"><span class="comment"># 关闭加密</span></span><br><span class="line"><span class="keyword">set</span>(BL_ENCRYPTING no)</span><br></pre></td></tr></table></figure>

<h1 id="打开加密时的依赖项"><a href="#打开加密时的依赖项" class="headerlink" title="打开加密时的依赖项"></a>打开加密时的依赖项</h1><h2 id="烧入efuse-key"><a href="#烧入efuse-key" class="headerlink" title="烧入efuse key"></a>烧入efuse key</h2><p><img src="/image-20211022162941641.png" alt="image-20211022162941641"></p>
<p>BouffaloLabDevCube -&gt; View-&gt; MCU -&gt; Efuse Key</p>
<p>三个需要改的地方, AES MODE 选 <code>None</code> !!!</p>
<ul>
<li><p>ef_key_slot2(hex)     ce043c3e22ad711d4033c548970b0a7b  Write Lock Read Lock 打勾  </p>
</li>
<li><p>ef_key_slot3(hex)     0710340a96e1f0d3bbc355b2261b4c2b  Write Lock Read Lock 打勾</p>
</li>
</ul>
<p>改完后, 点击软件上的<code>Create</code>按钮, 生成efuse数据文件</p>
<p>板子和pc 使用typec 连接, 先按boot 按键0.5s, <code>boot</code>按键不要松开, 再接着另一个手指按<code>reset</code>按键, 两个按键一起按3s后, 两个按键同时松开, 此时按软件上的Refresh按钮, COM Port 中出现COM3, 选择COM3.</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/09/12/hxd_new/bl_guide/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://liguangzhang.github.io/2021/09/12/OTA%E7%9B%B8%E5%85%B3/%E5%90%9B%E6%AD%A3linux%20ota/%E5%90%9B%E6%AD%A3linux%20ota%E5%8D%87%E7%BA%A7%E6%96%B9%E6%A1%88%E8%B0%83%E7%A0%94/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liguang.zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/12/OTA%E7%9B%B8%E5%85%B3/%E5%90%9B%E6%AD%A3linux%20ota/%E5%90%9B%E6%AD%A3linux%20ota%E5%8D%87%E7%BA%A7%E6%96%B9%E6%A1%88%E8%B0%83%E7%A0%94/" class="post-title-link" itemprop="url">君正linux ota升级方案调研</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-12 18:15:54" itemprop="dateCreated datePublished" datetime="2021-09-12T18:15:54+08:00">2021-09-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-04-16 18:05:58" itemprop="dateModified" datetime="2024-04-16T18:05:58+08:00">2024-04-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OTA/" itemprop="url" rel="index"><span itemprop="name">OTA</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OTA/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OTA/linux/%E5%90%9B%E6%AD%A3/" itemprop="url" rel="index"><span itemprop="name">君正</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="分区"><a href="#分区" class="headerlink" title="分区"></a>分区</h1><p>^b2c15f</p>
<h2 id="nand"><a href="#nand" class="headerlink" title="nand"></a>nand</h2><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[storageinfo]</span></span><br><span class="line"><span class="attr">mediumtype</span>=nand</span><br><span class="line"><span class="attr">capacity</span>=<span class="number">256</span>MB</span><br><span class="line"><span class="section">[partition]</span></span><br><span class="line"><span class="comment"># 分区名 偏移量 大小 设备名</span></span><br><span class="line"><span class="attr">item1</span>=uboot,<span class="number">0</span>x0,<span class="number">0</span>x100000,mtdblock0</span><br><span class="line"><span class="attr">item2</span>=nv,<span class="number">0</span>x100000,<span class="number">0</span>x100000,mtdblock1</span><br><span class="line"><span class="attr">item3</span>=kernel,<span class="number">0</span>x200000,<span class="number">0</span>x800000,mtdblock2</span><br><span class="line"><span class="attr">item4</span>=recovery,<span class="number">0</span>xa00000,<span class="number">0</span>x1000000,mtdblock3</span><br><span class="line"><span class="attr">item5</span>=system,<span class="number">0</span>x1a00000,<span class="number">0</span>x5000000,mtdblock4</span><br><span class="line"><span class="attr">item6</span>=userdata,<span class="number">0</span>x6a00000,<span class="number">0</span>x9300000,mtdblock5</span><br></pre></td></tr></table></figure>

<h1 id="升级主程序"><a href="#升级主程序" class="headerlink" title="升级主程序"></a>升级主程序</h1><p>也叫recovery</p>
<h2 id="全局配置文件"><a href="#全局配置文件" class="headerlink" title="全局配置文件"></a>全局配置文件</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">global_data</span> <span class="title">g_data</span> =</span> &#123;</span><br><span class="line">    .public_key_path = <span class="string">&quot;/usr/data/ota_res/key/key.pub&quot;</span>,</span><br><span class="line">    .configure_file_path = <span class="string">&quot;/usr/data/ota_res/recovery.conf&quot;</span>,</span><br><span class="line">    .font_path = <span class="string">&quot;/usr/data/ota_res/image/font.png&quot;</span>,</span><br><span class="line">    .audio_path = <span class="string">&quot;/usr/data/ota_res/tips&quot;</span>,</span><br><span class="line">    .has_fb = <span class="number">1</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>配置文件示例:<br>recovery.conf</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;server&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;ip&quot;</span>:<span class="string">&quot;192.168.1.105&quot;</span>,</span><br><span class="line">    <span class="string">&quot;url&quot;</span>:<span class="string">&quot;https://192.168.1.105&quot;</span>,</span><br><span class="line">    <span class="string">&quot;rpt_url&quot;</span>:<span class="string">&quot;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/09/12/OTA%E7%9B%B8%E5%85%B3/%E5%90%9B%E6%AD%A3linux%20ota/%E5%90%9B%E6%AD%A3linux%20ota%E5%8D%87%E7%BA%A7%E6%96%B9%E6%A1%88%E8%B0%83%E7%A0%94/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://liguangzhang.github.io/2021/09/11/hxd_new/%E5%8D%9A%E6%B5%81efuse/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liguang.zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/11/hxd_new/%E5%8D%9A%E6%B5%81efuse/" class="post-title-link" itemprop="url">bl efuse 操作 api</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-11 18:15:54" itemprop="dateCreated datePublished" datetime="2021-09-11T18:15:54+08:00">2021-09-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-04-16 14:54:31" itemprop="dateModified" datetime="2024-04-16T14:54:31+08:00">2024-04-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%8D%9A%E6%B5%81/" itemprop="url" rel="index"><span itemprop="name">博流</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****************************************************************************/</span> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief  Efuse lock reading for aes key</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param  index: index of key slot</span></span><br><span class="line"><span class="comment"> * @param  program: program to efuse entity or not</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @return None</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">EF_Ctrl_Readlock_AES_Key</span><span class="params">(<span class="type">uint8_t</span> index, <span class="type">uint8_t</span> program)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> tmpVal;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (index &gt; <span class="number">5</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Switch to AHB clock */</span></span><br><span class="line">    EF_Ctrl_Sw_AHB_Clk_0();</span><br><span class="line"></span><br><span class="line">    tmpVal = BL_RD_REG(EF_DATA_BASE, EF_DATA_0_LOCK);</span><br><span class="line">    tmpVal |= (<span class="number">1</span> &lt;&lt; (index + <span class="number">26</span>));</span><br><span class="line">    BL_WR_REG(EF_DATA_BASE, EF_DATA_0_LOCK, tmpVal);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (program) &#123;</span><br><span class="line">        EF_Ctrl_Program_Efuse_0();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/****************************************************************************/</span> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief  Efuse write AES key</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param  index: index of key slot</span></span><br><span class="line"><span class="comment"> * @param  keyData: key data buffer</span></span><br><span class="line"><span class="comment"> * @param  len: key data length in words</span></span><br><span class="line"><span class="comment"> * @param  program: program to efuse entity or not</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @return None</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">EF_Ctrl_Write_AES_Key</span><span class="params">(<span class="type">uint8_t</span> index, <span class="type">uint32_t</span> *keyData, <span class="type">uint32_t</span> len, <span class="type">uint8_t</span> program)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> *pAESKeyStart0 = (<span class="type">uint32_t</span> *)(EF_DATA_BASE + <span class="number">0x1C</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (index &gt; <span class="number">5</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Switch to AHB clock */</span></span><br><span class="line">    EF_Ctrl_Sw_AHB_Clk_0();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Every key is 4 words len*/</span></span><br><span class="line">    BL702_MemCpy4(pAESKeyStart0 + index * <span class="number">4</span>, keyData, len);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (program) &#123;</span><br><span class="line">        EF_Ctrl_Program_Efuse_0();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码示例:</p>
<p>假设key为</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">uint32_t</span> *keyData = &#123;</span><br><span class="line">    <span class="number">0x41cb3b9a</span>,</span><br><span class="line">    <span class="number">0x7cf9f7cf</span>,</span><br><span class="line">    <span class="number">0xdc0dd12f</span>,</span><br><span class="line">    <span class="number">0x6c3ed53a</span>,</span><br><span class="line">    <span class="number">0x00a0c824</span>,</span><br><span class="line">    <span class="number">0xc737923e</span>,</span><br><span class="line">    <span class="number">0xe2f055f1</span>,</span><br><span class="line">    <span class="number">0x34afa0f7</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 写入key_slot2 key_slot3</span></span><br><span class="line">EF_Ctrl_Write_AES_Key(<span class="number">2</span>, keyData, <span class="number">8</span>, <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>先做实验, 验证key_slot2, key_slot3 是否正常写入</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****************************************************************************/</span> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief  Efuse read AES key from specified region and index</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param  index: index of key slot</span></span><br><span class="line"><span class="comment"> * @param  keyData: key data buffer</span></span><br><span class="line"><span class="comment"> * @param  len: key data length in words</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @return None</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">EF_Ctrl_Read_AES_Key</span><span class="params">(<span class="type">uint8_t</span> index, <span class="type">uint32_t</span> *keyData, <span class="type">uint32_t</span> len)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> *pAESKeyStart0 = (<span class="type">uint32_t</span> *)(EF_DATA_BASE + <span class="number">0x1C</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (index &gt; <span class="number">5</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Trigger read data from efuse*/</span></span><br><span class="line">    EF_CTRL_LOAD_BEFORE_READ_R0;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Every key is 4 words len*/</span></span><br><span class="line">    BL702_MemCpy4(keyData, pAESKeyStart0 + index * <span class="number">4</span>, len);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>示例代码, 读取key_slot2, key_slot3的key数据</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">uint32_t</span> keyRead[<span class="number">8</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">EF_Ctrl_Read_AES_Key(<span class="number">2</span>, keyRead, <span class="number">8</span>);</span><br></pre></td></tr></table></figure>

<p>判断keyRead 与 keyData 是否一致</p>
<p>如果前面写入正常, 最后需要对key_slot2, key_slot3 做读保护</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/09/11/hxd_new/%E5%8D%9A%E6%B5%81efuse/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://liguangzhang.github.io/2021/09/11/hxd_new/%E5%AE%89%E5%85%A8%E6%89%8B%E5%86%8C%E7%9B%B8%E5%85%B3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liguang.zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/11/hxd_new/%E5%AE%89%E5%85%A8%E6%89%8B%E5%86%8C%E7%9B%B8%E5%85%B3/" class="post-title-link" itemprop="url">MIPS 杂项</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-11 18:15:54" itemprop="dateCreated datePublished" datetime="2021-09-11T18:15:54+08:00">2021-09-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-04-16 14:52:51" itemprop="dateModified" datetime="2024-04-16T14:52:51+08:00">2024-04-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/MIPS/" itemprop="url" rel="index"><span itemprop="name">MIPS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="MIPS-相关理解"><a href="#MIPS-相关理解" class="headerlink" title="MIPS 相关理解"></a>MIPS 相关理解</h1><h2 id="协处理器"><a href="#协处理器" class="headerlink" title="协处理器"></a>协处理器</h2><p>在MIPS体系结构中，最多支持4个协处理器(Co-Processor)。其中，协处理器<code>CP0</code>是体系结构中必须实现的。它起到控制CPU的作用。MMU、异常处理、乘除法等功能，都依赖于协处理器CP0来实现。它是MIPS的精髓之一，也是打开MIPS特权级模式的大门。</p>
<pre><code>   - Register 0: Index，作为MMU的索引用。将来讨论MMU和TLB时会详解之。
   - Register 2, EntryLo0，访问TLB Entry偶数页中的地址低32Bit用。同上，在MMU和TLB的相关章节中详解。
   - Register 3, EntryLo1，访问TLB Entry奇数页中的地址低32Bit用。
   - Register 4, Context，用以加速TLB Miss异常的处理。
   - Register 5, PageMask，用以在MMU中分配可变大小的内存页。
   - Register 8, BadVAddr，在系统捕获到TLB Miss或Address Error这两种Exception时，发生错误的虚拟地址会储存在该寄存器中。对于引发Exception的Bug的定位来说，这个寄存器非常重要。
   - `Register 9`, Count，这个寄存器是R4000以后的MIPS系统引入的。它是一个计数器，`计数频率是系统主频的1/2`。BCM1125/1250，RMI XLR系列以及Octeon的Cavium处理器均支持该寄存器。对于操作系统来说，`可以通过读取该寄存器的值来获取tick的时基`。`在系统性能测试中，利用该寄存器也可以实现打点计数`。
   - Register 10，EntryHi，这个寄存器同EntryLo0/1一样，用于MMU中。以后会详述。
   - Register 11，Compare，配合Count使用。当Compare和Count的值相等的时候，会触发一个硬件中断(Hardware Interrupt)，并且总是使用Cause寄存器的IP7位。　　
   - Register 12，Status，用于处理器状态的控制。
   - Register 13，Cause，这个寄存器体现了处理器异常发生的原因。
   - 　　Register 14，EPC，这个寄存器存放异常发生时，系统正在执行的指令的地址。
   - 　　Register 15，PRID，这个寄存器是只读的，标识处理器的版本信息。向其中写入无意义。
</code></pre>
<ul>
<li>　　Register 18&#x2F;19，WatchLo&#x2F;WatchHi，这对寄存器用于设置硬件数据断点(Hardware Data Breakpoint)。该断点一旦设定，当CPU存取这个地址时，系统就会发生一个异常。这个功能广泛应用于调试定位内存写坏的错误。<br> 　　Register 28&#x2F;29，TagLo和TagHi，用于高速缓存(Cache)管理。</li>
</ul>
<p>相关链接 <a target="_blank" rel="noopener" href="https://blog.csdn.net/jiura/article/details/6645277">协处理器CP0</a></p>
<h3 id="常用汇编指令"><a href="#常用汇编指令" class="headerlink" title="常用汇编指令"></a>常用汇编指令</h3><p>MFC0、MTC0、DMFC0、DMTC0可以完成通用寄存器和CP0寄存器之间的数据传送。比如我们可以通过下面指令来获取epc寄存器的值。</p>
<pre><code>             mfc0 t1,$14           # 从CP0 取epc寄存器（$14）数据，存到通用寄存器t0
</code></pre>
<p>mfc0完成从cp0寄存器获取一个32位数据（如果cp0寄存器是64位数据则只取其低32位。）到通用寄存器，如果要获取的是64位数据则需要使用dmfc0指令。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/09/11/hxd_new/%E5%AE%89%E5%85%A8%E6%89%8B%E5%86%8C%E7%9B%B8%E5%85%B3/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">liguang.zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">147</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">88</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">102</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="sidebar-button motion-element"><i class="fa fa-comment"></i>
    Chat
  </a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">liguang.zhang</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
